<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ä»Šæ—¥è‹±é•‘è´­æ±‡ä»·æ ¼ï¼ˆä¸­è¡Œç°æ±‡å–å‡ºä»·ï¼‰</title>
  <style>
    * { box-sizing: border-box; }
    body { 
      margin: 0; 
      font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Microsoft YaHei", sans-serif; 
      background: #fff0f5;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    .card { 
      width: min(1100px, 100%); 
      aspect-ratio: 16/9; 
      background: #fff;
      border: 3px solid #111; 
      border-radius: 24px; 
      position: relative; 
      overflow: hidden;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    }
    
    .content { 
      position: absolute; 
      inset: 0; 
      padding: clamp(30px, 5vw, 56px) clamp(40px, 6vw, 64px);
      display: flex;
      flex-direction: column;
    }
    
    /* æ ‡é¢˜åŒº */
    .header {
      text-align: center;
    }
    
    .h1 { 
      font-size: clamp(32px, 4.7vw, 52px); 
      font-weight: 900; 
      letter-spacing: 2px; 
      margin: 0;
      color: #111;
    }
    
    .sub { 
      margin-top: 8px; 
      font-size: clamp(14px, 1.6vw, 18px); 
      color: #555; 
      font-weight: 600; 
    }
    
    .date { 
      margin-top: 6px; 
      font-size: clamp(16px, 2vw, 22px); 
      font-weight: 700;
      color: #333;
    }
    
    /* ä¸»å†…å®¹åŒº */
    .main { 
      display: flex; 
      align-items: center; 
      justify-content: flex-start;
      margin-top: auto;
      margin-bottom: auto;
      gap: clamp(20px, 4vw, 40px);
      position: relative;
    }
    
    .left { 
      flex: 1;
      min-width: 0;
    }
    
    .label { 
      font-size: clamp(24px, 3vw, 34px); 
      font-weight: 900; 
      margin-bottom: clamp(12px, 1.6vw, 18px);
      color: #111;
    }
    
    .rate { 
      font-size: clamp(48px, 7.6vw, 84px); 
      font-weight: 950; 
      line-height: 1.1;
      color: #111;
      display: flex;
      align-items: baseline;
      gap: clamp(8px, 1.5vw, 16px);
      flex-wrap: wrap;
    }
    
    .rate .currency {
      font-size: clamp(28px, 4vw, 48px);
      font-weight: 900;
    }
    
    .rate .equals {
      font-size: clamp(32px, 5vw, 56px);
      font-weight: 900;
    }
    
    .rate .value {
      font-size: clamp(48px, 7.6vw, 84px);
      font-weight: 950;
    }
    
    .rate .unit {
      font-size: clamp(24px, 3vw, 34px);
      font-weight: 900;
      color: #333;
    }
    
    /* å˜åŒ–æŒ‡ç¤ºå™¨ */
    .change {
      margin-top: 12px;
      font-size: clamp(16px, 1.8vw, 20px);
      font-weight: 700;
    }
    
    .change.up { color: #d32f2f; }
    .change.down { color: #388e3c; }
    .change.neutral { color: #666; }
    
    /* å³ä¾§è£…é¥° - ç‹¬ç«‹å…ƒç´ ï¼Œä¸å— flex å®¹å™¨é™åˆ¶ */
    .illustration { 
      width: clamp(220px, 28vw, 320px); 
      height: clamp(220px, 28vw, 320px); 
      border-radius: 16px; 
      background: #ffffff;
      display: flex; 
      align-items: flex-end;
      justify-content: center; 
      flex-shrink: 0;
      position: absolute;
      right: clamp(20px, 2.5vw, 40px);
      bottom: clamp(55px, 7vw, 80px);
      z-index: 1;
    }
    
    .illustration img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: 16px;
    }
    
    /* é¡µè„š */
    .foot { 
      position: absolute; 
      right: clamp(20px, 2.5vw, 28px); 
      bottom: clamp(16px, 2vw, 22px); 
      font-size: clamp(11px, 1.2vw, 14px); 
      color: #666; 
      font-weight: 600; 
      text-align: right;
      line-height: 1.5;
      z-index: 10;
      background: rgba(255, 255, 255, 0.9);
      padding: 2px 0;
    }
    
    /* åŠ è½½å’Œé”™è¯¯çŠ¶æ€ */
    .loading, .error {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.95);
      z-index: 10;
      font-size: 20px;
      font-weight: 600;
    }
    
    .loading { color: #666; }
    .error { color: #d32f2f; flex-direction: column; gap: 12px; }
    
    .hidden { display: none !important; }
    
    /* å“åº”å¼è°ƒæ•´ */
    @media (max-width: 768px) {
      .main { flex-direction: column; gap: 24px; }
      .illustration { 
        width: 180px; 
        height: 180px;
        right: 15px;
        bottom: 55px;
      }
      .foot {
        max-width: calc(100% - 200px);
      }
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="loading" id="loading">æ­£åœ¨åŠ è½½æ•°æ®...</div>
    
    <div class="error hidden" id="error">
      <div>âŒ æ•°æ®åŠ è½½å¤±è´¥</div>
      <div style="font-size: 14px; color: #999;">è¯·ç¨ååˆ·æ–°é¡µé¢é‡è¯•</div>
    </div>
    
    <div class="content" id="content" style="opacity: 0;">
      <div class="header">
        <h1 class="h1">ä»Šæ—¥è‹±é•‘è´­æ±‡ä»·æ ¼</h1>
        <div class="sub">ä¸­å›½é“¶è¡Œ | ç°æ±‡å–å‡ºä»·ï¼ˆç”¨äººæ°‘å¸è´­ä¹°è‹±é•‘ï¼‰</div>
        <div class="date" id="date">ğŸ‡¬ğŸ‡§ æ—¥æœŸï¼š-- (UTC+0)</div>
      </div>

      <div class="main">
        <div class="left">
          <div class="label">ä»Šæ—¥è‹±é•‘è´­æ±‡ä»·</div>
          <div class="rate">
            <span class="currency">1 GBP</span>
            <span class="equals">=</span>
            <span class="value" id="rate">--</span>
            <span class="unit">CNY</span>
          </div>
          <div class="change hidden" id="change">è¾ƒä¸Šæ¬¡: --</div>
        </div>
      </div>
      
      <!-- Hello Kitty ç‹¬ç«‹å…ƒç´ ï¼Œä¸å— flex å®¹å™¨é™åˆ¶ -->
      <div class="illustration">
        <img src="hello-kitty.png" alt="Hello Kitty">
      </div>

      <div class="foot" id="foot">
        æ•°æ®æ¥æºï¼šä¸­å›½é“¶è¡Œå¤–æ±‡ç‰Œä»·<br/>
        ä»·æ ¼ç±»å‹ï¼šç°æ±‡å–å‡ºä»·<br/>
        ğŸ‡¬ğŸ‡§ æ›´æ–°æ—¶é—´ï¼š-- (UTC+0)
      </div>
    </div>
  </div>

<script>
(function() {
  const elements = {
    loading: document.getElementById('loading'),
    error: document.getElementById('error'),
    content: document.getElementById('content'),
    date: document.getElementById('date'),
    rate: document.getElementById('rate'),
    change: document.getElementById('change'),
    foot: document.getElementById('foot')
  };
  
  function formatDateTime(isoString) {
    try {
      const date = new Date(isoString);
      // æ ¼å¼åŒ–ä¸ºè‹±å›½æ—¶é—´ï¼ˆUTC+0ï¼‰
      return date.toLocaleString('en-GB', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        hour12: false,
        timeZone: 'Europe/London'
      });
    } catch {
      return isoString;
    }
  }
  
  function showError() {
    elements.loading.classList.add('hidden');
    elements.error.classList.remove('hidden');
    elements.content.style.opacity = '0';
  }
  
  function showContent() {
    elements.loading.classList.add('hidden');
    elements.error.classList.add('hidden');
    elements.content.style.opacity = '1';
    elements.content.style.transition = 'opacity 0.3s ease';
  }
  
  function updateUI(data) {
    // æ£€æŸ¥æ•°æ®çŠ¶æ€
    if (data.status === 'error') {
      showError();
      return;
    }
    
    // æ›´æ–°æ—¥æœŸ - ä½¿ç”¨è‹±å¼æ ¼å¼ä¸é¡µè„šç»Ÿä¸€
    let dateDisplay = '--';
    if (data.fetched_at_utc) {
      try {
        const date = new Date(data.fetched_at_utc);
        dateDisplay = date.toLocaleDateString('en-GB', {
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
          timeZone: 'Europe/London'
        });
      } catch (e) {
        dateDisplay = data.publish_time_raw ? data.publish_time_raw.split(' ')[0] : '--';
      }
    }
    elements.date.textContent = `ğŸ‡¬ğŸ‡§ æ—¥æœŸ: ${dateDisplay} (UTC+0)`;
    
    // æ›´æ–°æ±‡ç‡
    const rate = data.rate_cny_per_gbp || '--';
    elements.rate.textContent = rate;
    
    // æ›´æ–°å˜åŒ–
    if (data.rate_change !== undefined && data.rate_change !== 0) {
      const change = data.rate_change;
      const percent = data.rate_change_percent || 0;
      const arrow = change > 0 ? 'â†‘' : change < 0 ? 'â†“' : '';
      const className = change > 0 ? 'up' : change < 0 ? 'down' : 'neutral';
      
      elements.change.textContent = `è¾ƒä¸Šæ¬¡: ${arrow} ${Math.abs(change).toFixed(4)} (${percent > 0 ? '+' : ''}${percent.toFixed(2)}%)`;
      elements.change.className = `change ${className}`;
      elements.change.classList.remove('hidden');
    }
    
    // æ›´æ–°é¡µè„š
    const updateTime = formatDateTime(data.fetched_at_utc || '');
    elements.foot.innerHTML = `
      æ•°æ®æ¥æº: ä¸­å›½é“¶è¡Œå¤–æ±‡ç‰Œä»·<br/>
      ä»·æ ¼ç±»å‹: ${data.boc_field || 'ç°æ±‡å–å‡ºä»·'}<br/>
      ğŸ‡¬ğŸ‡§ æ›´æ–°æ—¶é—´: ${updateTime} (UTC+0)
    `;
    
    showContent();
  }
  
  // åŠ è½½æ•°æ®
  fetch('./data.json', { 
    cache: 'no-store',
    headers: { 'Cache-Control': 'no-cache' }
  })
    .then(response => {
      if (!response.ok) {
        throw new Error(`HTTP ${response.status}`);
      }
      return response.json();
    })
    .then(data => {
      console.log('Loaded data:', data);
      updateUI(data);
    })
    .catch(err => {
      console.error('Failed to load data:', err);
      showError();
    });
})();
</script>
</body>
</html>
