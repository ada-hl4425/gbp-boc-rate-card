<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>今日英镑购汇价格（中行现汇卖出价）</title>
  <style>
    * { box-sizing: border-box; }
    body { 
      margin: 0; 
      font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Microsoft YaHei", sans-serif; 
      background: #fff0f5;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    .card { 
      width: min(1100px, 100%); 
      aspect-ratio: 16/9; 
      background: #fff;
      border: 3px solid #111; 
      border-radius: 24px; 
      position: relative; 
      overflow: hidden;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    }
    
    /* 网格背景 */
    .grid { 
      position: absolute; 
      inset: 0; 
      background-image: 
        linear-gradient(#f0f0f0 1px, transparent 1px),
        linear-gradient(90deg, #f0f0f0 1px, transparent 1px); 
      background-size: 40px 40px; 
      opacity: 0.6; 
    }
    
    .content { 
      position: absolute; 
      inset: 0; 
      padding: clamp(30px, 5vw, 56px) clamp(40px, 6vw, 64px);
      display: flex;
      flex-direction: column;
    }
    
    /* 标题区 */
    .header {
      text-align: center;
    }
    
    .h1 { 
      font-size: clamp(32px, 4.7vw, 52px); 
      font-weight: 900; 
      letter-spacing: 2px; 
      margin: 0;
      color: #111;
    }
    
    .sub { 
      margin-top: 8px; 
      font-size: clamp(14px, 1.6vw, 18px); 
      color: #555; 
      font-weight: 600; 
    }
    
    .date { 
      margin-top: 6px; 
      font-size: clamp(16px, 2vw, 22px); 
      font-weight: 700;
      color: #333;
    }
    
    /* 主内容区 */
    .main { 
      display: flex; 
      align-items: center; 
      justify-content: space-between; 
      margin-top: auto;
      margin-bottom: auto;
      gap: clamp(20px, 4vw, 40px);
    }
    
    .left { 
      flex: 1;
      min-width: 0;
    }
    
    .label { 
      font-size: clamp(24px, 3vw, 34px); 
      font-weight: 900; 
      margin-bottom: clamp(12px, 1.6vw, 18px);
      color: #111;
    }
    
    .rate { 
      font-size: clamp(48px, 7.6vw, 84px); 
      font-weight: 950; 
      line-height: 1.1;
      color: #111;
      display: flex;
      align-items: baseline;
      gap: clamp(8px, 1.5vw, 16px);
      flex-wrap: wrap;
    }
    
    .rate .currency {
      font-size: clamp(28px, 4vw, 48px);
      font-weight: 900;
    }
    
    .rate .equals {
      font-size: clamp(32px, 5vw, 56px);
      font-weight: 900;
    }
    
    .rate .value {
      font-size: clamp(48px, 7.6vw, 84px);
      font-weight: 950;
    }
    
    .rate .unit {
      font-size: clamp(24px, 3vw, 34px);
      font-weight: 900;
      color: #333;
    }
    
    /* 变化指示器 */
    .change {
      margin-top: 12px;
      font-size: clamp(16px, 1.8vw, 20px);
      font-weight: 700;
    }
    
    .change.up { color: #d32f2f; }
    .change.down { color: #388e3c; }
    .change.neutral { color: #666; }
    
    /* 右侧装饰 */
    .illustration { 
      width: clamp(180px, 23vw, 260px); 
      height: clamp(180px, 23vw, 260px); 
      border-radius: 16px; 
      background: #ffe6f2;
      display: flex; 
      align-items: center; 
      justify-content: center; 
      font-weight: 700; 
      color: #c2185b;
      font-size: clamp(14px, 1.6vw, 18px);
      flex-shrink: 0;
    }
    
    .illustration img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: 16px;
    }
    
    /* 页脚 */
    .foot { 
      position: absolute; 
      right: clamp(20px, 2.5vw, 28px); 
      bottom: clamp(16px, 2vw, 22px); 
      font-size: clamp(11px, 1.2vw, 14px); 
      color: #666; 
      font-weight: 600; 
      text-align: right;
      line-height: 1.5;
    }
    
    /* 加载和错误状态 */
    .loading, .error {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.95);
      z-index: 10;
      font-size: 20px;
      font-weight: 600;
    }
    
    .loading { color: #666; }
    .error { color: #d32f2f; flex-direction: column; gap: 12px; }
    
    .hidden { display: none !important; }
    
    /* 响应式调整 */
    @media (max-width: 768px) {
      .main { flex-direction: column; gap: 24px; }
      .illustration { width: 160px; height: 160px; }
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="grid"></div>
    
    <div class="loading" id="loading">正在加载数据...</div>
    
    <div class="error hidden" id="error">
      <div>❌ 数据加载失败</div>
      <div style="font-size: 14px; color: #999;">请稍后刷新页面重试</div>
    </div>
    
    <div class="content" id="content" style="opacity: 0;">
      <div class="header">
        <h1 class="h1">今日英镑购汇价格</h1>
        <div class="sub">中国银行 | 现汇卖出价（用人民币购买英镑）</div>
        <div class="date" id="date">日期：--</div>
      </div>

      <div class="main">
        <div class="left">
          <div class="label">今日英镑购汇价</div>
          <div class="rate">
            <span class="currency">1 GBP</span>
            <span class="equals">=</span>
            <span class="value" id="rate">--</span>
            <span class="unit">CNY</span>
          </div>
          <div class="change hidden" id="change">较上次: --</div>
        </div>
        
        <div class="illustration">
          <!-- 如需替换为图片: <img src="hello-kitty.png" alt="Hello Kitty"> -->
          <img src="hello-kitty.png" alt="Hello Kitty">
        </div>
      </div>

      <div class="foot" id="foot">
        数据来源：中国银行外汇牌价<br/>
        价格类型：现汇卖出价<br/>
        更新时间：--
      </div>
    </div>
  </div>

<script>
(function() {
  const elements = {
    loading: document.getElementById('loading'),
    error: document.getElementById('error'),
    content: document.getElementById('content'),
    date: document.getElementById('date'),
    rate: document.getElementById('rate'),
    change: document.getElementById('change'),
    foot: document.getElementById('foot')
  };
  
  function formatDateTime(isoString) {
    try {
      const date = new Date(isoString);
      return date.toLocaleString('zh-CN', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        hour12: false
      });
    } catch {
      return isoString;
    }
  }
  
  function showError() {
    elements.loading.classList.add('hidden');
    elements.error.classList.remove('hidden');
    elements.content.style.opacity = '0';
  }
  
  function showContent() {
    elements.loading.classList.add('hidden');
    elements.error.classList.add('hidden');
    elements.content.style.opacity = '1';
    elements.content.style.transition = 'opacity 0.3s ease';
  }
  
  function updateUI(data) {
    // 检查数据状态
    if (data.status === 'error') {
      showError();
      return;
    }
    
    // 更新日期
    const dateStr = data.publish_time_raw || data.fetched_at_beijing || '--';
    elements.date.textContent = `日期: ${dateStr.split(' ')[0] || dateStr}`;
    
    // 更新汇率
    const rate = data.rate_cny_per_gbp || '--';
    elements.rate.textContent = rate;
    
    // 更新变化
    if (data.rate_change !== undefined && data.rate_change !== 0) {
      const change = data.rate_change;
      const percent = data.rate_change_percent || 0;
      const arrow = change > 0 ? '↑' : change < 0 ? '↓' : '';
      const className = change > 0 ? 'up' : change < 0 ? 'down' : 'neutral';
      
      elements.change.textContent = `较上次: ${arrow} ${Math.abs(change).toFixed(4)} (${percent > 0 ? '+' : ''}${percent.toFixed(2)}%)`;
      elements.change.className = `change ${className}`;
      elements.change.classList.remove('hidden');
    }
    
    // 更新页脚
    const updateTime = formatDateTime(data.fetched_at_utc || '');
    elements.foot.innerHTML = `
      数据来源: 中国银行外汇牌价<br/>
      价格类型: ${data.boc_field || '现汇卖出价'}<br/>
      更新时间: ${updateTime}
    `;
    
    showContent();
  }
  
  // 加载数据
  fetch('./data.json', { 
    cache: 'no-store',
    headers: { 'Cache-Control': 'no-cache' }
  })
    .then(response => {
      if (!response.ok) {
        throw new Error(`HTTP ${response.status}`);
      }
      return response.json();
    })
    .then(data => {
      console.log('Loaded data:', data);
      updateUI(data);
    })
    .catch(err => {
      console.error('Failed to load data:', err);
      showError();
    });
})();
</script>
</body>
</html>
