<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ä»Šæ—¥è‹±é•‘è´­æ±‡ä»·æ ¼ - å¤šé“¶è¡Œå¯¹æ¯”</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Microsoft YaHei", sans-serif;
      background: #fff0f5;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .card {
      width: min(1100px, 100%);
      aspect-ratio: 16/9;
      background: #fff;
      border: 3px solid #111;
      border-radius: 24px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    }

    .content {
      position: absolute;
      inset: 0;
      padding: clamp(20px, 3vw, 36px) clamp(30px, 4vw, 48px);
      display: flex;
      flex-direction: column;
    }

    /* æ ‡é¢˜åŒº */
    .header {
      text-align: center;
      flex-shrink: 0;
    }

    .h1 {
      font-size: clamp(24px, 3.5vw, 40px);
      font-weight: 900;
      letter-spacing: 2px;
      margin: 0;
      color: #111;
    }

    .sub {
      margin-top: 4px;
      font-size: clamp(12px, 1.4vw, 16px);
      color: #555;
      font-weight: 600;
    }

    .date {
      margin-top: 4px;
      font-size: clamp(13px, 1.6vw, 18px);
      font-weight: 700;
      color: #333;
    }

    /* ä¸»å†…å®¹åŒº */
    .main {
      display: flex;
      align-items: stretch;
      justify-content: space-between;
      flex: 1;
      margin-top: clamp(12px, 2vw, 24px);
      gap: clamp(20px, 3vw, 40px);
      min-height: 0;
    }

    /* å·¦ä¾§ï¼šé“¶è¡Œåˆ—è¡¨ */
    .list-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-width: 0;
      max-width: 550px;
    }

    .list-title {
      font-size: clamp(13px, 1.5vw, 17px);
      font-weight: 700;
      color: #666;
      margin-bottom: clamp(8px, 1.2vw, 14px);
      flex-shrink: 0;
    }

    .bank-list {
      display: flex;
      flex-direction: column;
      gap: clamp(5px, 0.7vw, 8px);
      overflow-y: auto;
      flex: 1;
      min-height: 0;
    }

    .bank-item {
      display: flex;
      align-items: center;
      padding: clamp(8px, 1vw, 12px) clamp(12px, 1.4vw, 18px);
      background: #f8f8f8;
      border-radius: 10px;
      border-left: 4px solid #ccc;
      transition: all 0.2s ease;
    }

    .bank-item:hover {
      background: #f0f0f0;
      transform: translateX(3px);
    }

    /* æœ€ä¼˜é“¶è¡Œé«˜äº®æ ·å¼ */
    .bank-item.best {
      background: linear-gradient(135deg, #fff0f5 0%, #ffe4ec 100%);
      border: 2px solid #ff6b9d;
      border-left: 4px solid #ff1493;
      box-shadow: 0 3px 10px rgba(255, 20, 147, 0.15);
    }

    .bank-item.best .bank-name {
      font-weight: 800;
    }

    .bank-item.best .bank-rate {
      color: #d6006f;
      font-weight: 900;
    }

    .best-badge {
      display: none;
      align-items: center;
      justify-content: center;
      width: clamp(24px, 3vw, 32px);
      height: clamp(24px, 3vw, 32px);
      background: linear-gradient(135deg, #ff6b9d, #ff1493);
      border-radius: 50%;
      font-size: clamp(12px, 1.4vw, 16px);
      margin-right: clamp(8px, 1vw, 12px);
      flex-shrink: 0;
    }

    .bank-item.best .best-badge {
      display: flex;
    }

    .bank-name {
      font-size: clamp(14px, 1.6vw, 18px);
      font-weight: 700;
      min-width: clamp(45px, 5vw, 60px);
    }

    .bank-rate {
      font-size: clamp(16px, 2vw, 22px);
      font-weight: 800;
      margin-left: auto;
    }

    .bank-unit {
      font-size: clamp(12px, 1.3vw, 15px);
      font-weight: 600;
      color: #666;
      margin-left: 4px;
    }

    .bank-change {
      font-size: clamp(10px, 1.1vw, 13px);
      font-weight: 600;
      margin-left: clamp(8px, 1vw, 14px);
      min-width: clamp(60px, 8vw, 90px);
      text-align: right;
    }

    .bank-change.up { color: #d32f2f; }
    .bank-change.down { color: #388e3c; }
    .bank-change.neutral { color: #999; }

    /* å³ä¾§ï¼šHello Kitty */
    .kitty-section {
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .illustration {
      width: clamp(160px, 22vw, 260px);
      height: clamp(160px, 22vw, 260px);
      border-radius: 16px;
      background: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .illustration img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: 16px;
    }

    /* é¡µè„š */
    .foot {
      position: absolute;
      right: clamp(15px, 2vw, 24px);
      bottom: clamp(10px, 1.5vw, 16px);
      font-size: clamp(10px, 1.1vw, 13px);
      color: #666;
      font-weight: 600;
      text-align: right;
      line-height: 1.4;
      z-index: 10;
      background: rgba(255, 255, 255, 0.95);
      padding: 2px 4px;
      border-radius: 4px;
    }

    /* åŠ è½½å’Œé”™è¯¯çŠ¶æ€ */
    .loading, .error {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.95);
      z-index: 10;
      font-size: 20px;
      font-weight: 600;
    }

    .loading { color: #666; }
    .error { color: #d32f2f; flex-direction: column; gap: 12px; }

    .hidden { display: none !important; }

    /* å“åº”å¼è°ƒæ•´ */
    @media (max-width: 768px) {
      .card {
        aspect-ratio: auto;
        min-height: 90vh;
      }

      .main {
        flex-direction: column;
        gap: 20px;
      }

      .list-section {
        max-width: none;
        flex: 1;
      }

      .kitty-section {
        position: absolute;
        right: 10px;
        bottom: 40px;
      }

      .illustration {
        width: 80px;
        height: 80px;
      }

      .foot {
        max-width: calc(100% - 100px);
      }
    }

    /* é“¶è¡Œé¢œè‰² */
    .bank-boc { border-left-color: #e60012; }
    .bank-icbc { border-left-color: #c4161c; }
    .bank-ccb { border-left-color: #004098; }
    .bank-cmb { border-left-color: #c41230; }
    .bank-bocom { border-left-color: #004a8f; }
    .bank-abc { border-left-color: #007f4e; }

    .bank-item.best.bank-boc,
    .bank-item.best.bank-icbc,
    .bank-item.best.bank-ccb,
    .bank-item.best.bank-cmb,
    .bank-item.best.bank-bocom,
    .bank-item.best.bank-abc {
      border-left-color: #ff1493;
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="loading" id="loading">æ­£åœ¨åŠ è½½æ•°æ®...</div>

    <div class="error hidden" id="error">
      <div>æ•°æ®åŠ è½½å¤±è´¥</div>
      <div style="font-size: 14px; color: #999;">è¯·ç¨ååˆ·æ–°é¡µé¢é‡è¯•</div>
    </div>

    <div class="content" id="content" style="opacity: 0;">
      <div class="header">
        <h1 class="h1">ä»Šæ—¥è‹±é•‘è´­æ±‡ä»·æ ¼</h1>
        <div class="sub">å…­å¤§é“¶è¡Œç°æ±‡å–å‡ºä»·å¯¹æ¯”ï¼ˆç”¨äººæ°‘å¸è´­ä¹°è‹±é•‘ï¼‰</div>
        <div class="date" id="date">æ—¥æœŸï¼š-- (UTC+0)</div>
      </div>

      <div class="main">
        <div class="list-section">
          <div class="list-title">å…¨éƒ¨é“¶è¡Œæ±‡ç‡ï¼ˆä½ = æ›´åˆ’ç®—ï¼‰</div>
          <div class="bank-list" id="bankList">
            <!-- åŠ¨æ€ç”Ÿæˆ -->
          </div>
        </div>

        <div class="kitty-section">
          <div class="illustration">
            <img src="hello-kitty.png" alt="Hello Kitty">
          </div>
        </div>
      </div>

      <div class="foot" id="foot">
        æ•°æ®æ¥æºï¼šå„é“¶è¡Œå®˜ç½‘å¤–æ±‡ç‰Œä»·<br/>
        ä»·æ ¼ç±»å‹ï¼šç°æ±‡å–å‡ºä»·<br/>
        æ›´æ–°æ—¶é—´ï¼š-- (UTC+0)
      </div>
    </div>
  </div>

<script>
(function() {
  const elements = {
    loading: document.getElementById('loading'),
    error: document.getElementById('error'),
    content: document.getElementById('content'),
    date: document.getElementById('date'),
    bankList: document.getElementById('bankList'),
    foot: document.getElementById('foot')
  };

  const bankColors = {
    'BOC': '#e60012',
    'ICBC': '#c4161c',
    'CCB': '#004098',
    'CMB': '#c41230',
    'BOCOM': '#004a8f',
    'ABC': '#007f4e'
  };

  function formatDateTime(isoString) {
    try {
      const date = new Date(isoString);
      return date.toLocaleString('en-GB', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        hour12: false,
        timeZone: 'Europe/London'
      });
    } catch (e) {
      return isoString;
    }
  }

  function showError() {
    elements.loading.classList.add('hidden');
    elements.error.classList.remove('hidden');
    elements.content.style.opacity = '0';
  }

  function showContent() {
    elements.loading.classList.add('hidden');
    elements.error.classList.add('hidden');
    elements.content.style.opacity = '1';
    elements.content.style.transition = 'opacity 0.3s ease';
  }

  function formatChange(change, percent) {
    if (change === undefined || change === null || change === 0) return null;
    const arrow = change > 0 ? 'â†‘' : 'â†“';
    const sign = percent > 0 ? '+' : '';
    return {
      text: arrow + ' ' + Math.abs(change).toFixed(4) + ' (' + sign + percent.toFixed(2) + '%)',
      className: change > 0 ? 'up' : 'down'
    };
  }

  function createBankItem(bank, isBest) {
    const item = document.createElement('div');
    const bankClass = bank.bank_code ? bank.bank_code.toLowerCase() : '';
    item.className = 'bank-item bank-' + bankClass + (isBest ? ' best' : '');

    if (!isBest && bank.bank_code) {
      item.style.borderLeftColor = bankColors[bank.bank_code] || '#ccc';
    }

    const changeInfo = formatChange(bank.rate_change, bank.rate_change_percent);
    const changeHtml = changeInfo
      ? '<span class="bank-change ' + changeInfo.className + '">' + changeInfo.text + '</span>'
      : '<span class="bank-change neutral">--</span>';

    const bestBadge = isBest ? '<span class="best-badge">ğŸ‘</span>' : '';

    item.innerHTML = bestBadge +
      '<span class="bank-name">' + (bank.short_name || bank.bank_name || '--') + '</span>' +
      '<span class="bank-rate">' + (bank.rate || '--') + '<span class="bank-unit">CNY</span></span>' +
      changeHtml;

    return item;
  }

  function updateUI(data) {
    console.log('updateUI called with:', data);

    // æ£€æŸ¥æ•°æ®çŠ¶æ€
    if (data.status === 'error') {
      console.log('Status is error');
      showError();
      return;
    }

    // æ£€æŸ¥ banks æ•°ç»„
    var banks = data.banks;
    if (!banks || !Array.isArray(banks) || banks.length === 0) {
      console.log('No banks data, banks:', banks);
      showError();
      return;
    }

    console.log('Banks count:', banks.length);

    // æ›´æ–°æ—¥æœŸ
    var dateDisplay = '--';
    if (data.fetched_at_utc) {
      try {
        var date = new Date(data.fetched_at_utc);
        dateDisplay = date.toLocaleDateString('en-GB', {
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
          timeZone: 'Europe/London'
        });
      } catch (e) {
        console.log('Date parse error:', e);
        dateDisplay = '--';
      }
    }
    elements.date.textContent = 'æ—¥æœŸ: ' + dateDisplay + ' (UTC+0)';

    // ç”Ÿæˆé“¶è¡Œåˆ—è¡¨ï¼ˆç¬¬ä¸€ä¸ªæ˜¯æœ€ä¼˜ï¼‰
    elements.bankList.innerHTML = '';
    for (var i = 0; i < banks.length; i++) {
      var bank = banks[i];
      var isBest = (i === 0);
      var item = createBankItem(bank, isBest);
      elements.bankList.appendChild(item);
      console.log('Added bank:', bank.short_name, bank.rate);
    }

    // æ›´æ–°é¡µè„š
    var updateTime = formatDateTime(data.fetched_at_utc || '');
    elements.foot.innerHTML =
      'æ•°æ®æ¥æº: å„é“¶è¡Œå®˜ç½‘å¤–æ±‡ç‰Œä»·<br/>' +
      'ä»·æ ¼ç±»å‹: ' + (data.rate_type || 'ç°æ±‡å–å‡ºä»·') + '<br/>' +
      'æ›´æ–°æ—¶é—´: ' + updateTime + ' (UTC+0)';

    showContent();
  }

  // åŠ è½½æ•°æ®
  console.log('Starting fetch...');
  fetch('./data.json', {
    cache: 'no-store',
    headers: { 'Cache-Control': 'no-cache' }
  })
    .then(function(response) {
      console.log('Response status:', response.status);
      if (!response.ok) {
        throw new Error('HTTP ' + response.status);
      }
      return response.json();
    })
    .then(function(data) {
      console.log('Loaded data:', JSON.stringify(data, null, 2));
      updateUI(data);
    })
    .catch(function(err) {
      console.error('Failed to load data:', err);
      showError();
    });
})();
</script>
</body>
</html>
